#!/bin/bash
make -j$(getconf _NPROCESSORS_ONLN) sdl comma2attr HardDisc4/stamp

find . -depth -exec ./comma2attr -- '{}' +

touch 'HardDisc4/!Boot/Choices/Boot/Tasks/Pinboard'
sort -u > Pinboard 'HardDisc4/!Boot/Choices/Boot/Tasks/Pinboard' - << END
X AddTinyDir IXFS::Root.\$.dev.fd.4
X AddTinyDir IXFS::Root.\$
X AddTinyDir IXFS::Root.\$$(echo $HOME | tr ./ /.)
X AddTinyDir IXFS::Root.\$.dev.fd.8
END
setfattr -n user.RISC_OS.LoadExec -v 0x00ebffff00000000 Pinboard
mv Pinboard 'HardDisc4/!Boot/Choices/Boot/Tasks/Pinboard'

RISC_OS_Alias_IXFSBoot='/IXFS:$.dev.fd.4.!Boot' exec ./sdl `uname -m | grep -q arm || echo qemu/arm-linux-user/qemu-arm` ./RISC_OS --nvram HardDisc4/CMOS 4<HardDisc4 8<. > /dev/null
